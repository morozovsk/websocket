<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="language" content="en"/>

    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="game.js"></script>
    <title>FinanceTank</title>
    <script type="text/javascript">
        $(function () {
            canvas = document.getElementById("field");
            ctx = canvas.getContext('2d');

            canvas.width = w * cellsize;
            canvas.height = h * cellsize;
            ctx.font = "12px Arial";

            window.addEventListener("keydown", keyDown, false);
            window.addEventListener("keyup", keyUp, false);
            canvas.focus();

            var chat = $("#chat");
            $('#chat').height($(window).height() - 80);

            function wsStart() {
                ws = new WebSocket("ws://127.0.0.1:8002/");
                ws.onopen = function () {
                    chat.append("<p>система: соединение открыто</p>");
                    chat.scrollTop($('#chat')[0].scrollHeight);
                    if (paused) {
                        paused = false;
                    } else {
                        mainLoop();
                    }
                };
                ws.onclose = function () {
                    chat.append("<p>система: соединение закрыто, пытаюсь переподключиться</p>");
                    chat.scrollTop($('#chat')[0].scrollHeight);
                    paused = false;
                    setTimeout(wsStart, 1000);
                };
                ws.onmessage = function (evt) {
                    tanks = JSON.parse(evt.data);
                    //chat.append("<p>" + evt.data + "</p>");

                    //moveTank(tanks[0]);
                    draw();

                    chat.scrollTop($('#chat')[0].scrollHeight);
                };
            }

            wsStart();

            $('#chat').height($(window).height() - 80);
            $('#login').height($(window).height() - 80);
        });

    </script>
</head>
<body style="overflow: hidden;">
<div id="canvasdiv" style="float: left;width: 1000px;">
    <canvas id='field' tabindex="1">Canvas here</canvas>
</div>

<div style="margin-left: 1000px; padding-left: 10px;">
    <div id='chat' style="overflow: auto;margin-bottom: 150px;" class="well">

    </div>
    <div class="navbar-fixed-bottom" style="margin-left: 1010px; margin-bottom: -25px;margin-right: 15px;">
        <form onsubmit="ws.send($('input').val()); $('input').val(''); return false; ">
            <input id="input" type="text" class="form-control" placeholder="Text input" style="width: 100%;" maxlength="140" autocomplete="off">
        </form>
    </div>
</div>
</body>
</html>
